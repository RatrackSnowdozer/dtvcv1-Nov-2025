<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hachures SVG avec D3</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 18px; }
  .controls { margin-bottom: 12px; }
  label { margin-right: 8px; }
  svg { border: 1px solid #ddd; background: #fff; }
</style>
</head>
<body>
  <h1>Hachures SVG (verticales et 45°) — réglage de l'espacement</h1>

  <div class="controls">
    <label for="spacing">Espacement (px): <span id="spacingVal">12</span></label>
    <input id="spacing" type="range" min="4" max="60" value="12" step="1" />
    &nbsp;&nbsp;
    <label for="strokeW">Épaisseur ligne: <span id="strokeVal">1</span>px</label>
    <input id="strokeW" type="range" min="0.5" max="6" value="1" step="0.5" />
  </div>

  <svg id="svg" width="600" height="260" viewBox="0 0 600 260" aria-label="Exemple de hachures"></svg>

<script>
// --- paramètres initiaux ---
let spacing = 12;         // espacement initial en px
let strokeW = 1;          // épaisseur ligne

const svg = d3.select("#svg");

// Créer defs et deux patterns: vertical (pour cercle) et rotated45 (pour triangle)
const defs = svg.append("defs");

function createPatterns(spacingPx, strokeWidthPx) {
  // On supprime puis recrée pour simplicité lors des updates
  defs.selectAll("*").remove();

  // Pattern vertical lines (patternUnits userSpaceOnUse pour contrôler l'espacement en px)
  defs.append("pattern")
    .attr("id", "hachures-vertical")
    .attr("patternUnits", "userSpaceOnUse")
    .attr("width", spacingPx)
    .attr("height", spacingPx)
    .attr("patternTransform", "rotate(0)")
    .append("line")
      .attr("x1", 0)
      .attr("y1", 0)
      .attr("x2", 0)
      .attr("y2", spacingPx)
      .attr("stroke", "#222")
      .attr("stroke-width", strokeWidthPx);

  // Pattern 45°: on dessine une ligne verticale dans pattern puis on tourne le pattern
  defs.append("pattern")
    .attr("id", "hachures-45")
    .attr("patternUnits", "userSpaceOnUse")
    .attr("width", spacingPx)
    .attr("height", spacingPx)
    .attr("patternTransform", "rotate(45)")
    .append("line")
      .attr("x1", 0)
      .attr("y1", 0)
      .attr("x2", 0)
      .attr("y2", spacingPx)
      .attr("stroke", "#222")
      .attr("stroke-width", strokeWidthPx);

  // Optionnel : ajouter un pattern semi-transparent pour fond léger (ici non utilisé)
}

// Dessiner formes
function drawShapes() {
  // effacer ce qui est déjà sur le svg sauf defs
  svg.selectAll(".shape").remove();

  // Cercle (avec hachures verticales)
  svg.append("circle")
    .attr("class", "shape")
    .attr("cx", 140)
    .attr("cy", 130)
    .attr("r", 90)
    .attr("fill", "url(#hachures-vertical)")
    .attr("stroke", "#333")
    .attr("stroke-width", 1.5);

  // Triangle (hachures 45°) : triangle équilatéral approximé
  const triX = 360, triY = 60, triSize = 160;
  const points = [
    [triX, triY],
    [triX - triSize/1.12, triY + triSize * 1.12],
    [triX + triSize/1.12, triY + triSize * 1.12]
  ].map(p => p.join(",")).join(" ");

  svg.append("polygon")
    .attr("class", "shape")
    .attr("points", points)
    .attr("fill", "url(#hachures-45)")
    .attr("stroke", "#333")
    .attr("stroke-width", 1.5);
}

// Mise à jour des patterns (sans redessiner les formes)
function updatePatterns(spacingPx, strokeWidthPx) {
  // Pour la simplicité et robustesse on recrée les defs puis on laisse les formes référencer les ids existants
  createPatterns(spacingPx, strokeWidthPx);
}

// Initial draw
updatePatterns(spacing, strokeW);
drawShapes();

// Contrôles UI
const spacingInput = d3.select("#spacing");
const spacingDisplay = d3.select("#spacingVal");
spacingInput.on("input", function() {
  spacing = +this.value;
  spacingDisplay.text(spacing);
  updatePatterns(spacing, strokeW);
});

const strokeInput = d3.select("#strokeW");
const strokeDisplay = d3.select("#strokeVal");
strokeInput.on("input", function() {
  strokeW = +this.value;
  strokeDisplay.text(strokeW);
  updatePatterns(spacing, strokeW);
});

</script>
</body>
</html>
